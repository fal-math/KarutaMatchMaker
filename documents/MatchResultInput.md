# 対戦結果入力ツール 要件定義

- [1. 概要](#1-概要)  
- [2. 機能要件](#2-機能要件)  
  - [2.1. 入力機能](#21-入力機能)  
  - [2.2. 対戦結果入力UI](#22-対戦結果入力ui)  
  - [2.3. データ処理機能](#23-データ処理機能)  
  - [2.4. 出力機能](#24-出力機能)  
- [3. 非機能要件](#3-非機能要件)  
- [4. 要件まとめ図](#4-要件まとめ図)  
  - [4.1. フロー図](#41-フロー図)  
  - [4.2. ファイル構造](#42-ファイル構造)  
  - [4.3. エラーハンドリング](#43-エラーハンドリング)  
- [5. 実装範囲](#5-実装範囲)  
- [6. テスト](#6-テスト)  
- [7. 今後の追加要件（検討中）](#7-今後の追加要件検討中)  
- [8. 改善履歴](#8-改善履歴)  

---

## 1. 概要

本ツールは、既存の「対戦組み合わせ決定ツール」で作成された対戦カード（CSV）を入力とし、  
競技かるたの「試合結果」をユーザーが入力できるWebベースのUIを提供するツールである。  

本ツールでは以下を実現する：  

1. 対戦組み合わせCSV（既存ツールで出力されたもの）を取り込み、対戦一覧をHTMLテーブルで表示する。  
2. 試合ごとの勝敗・得点などをユーザーが入力できるフォームを提供する。  
3. 入力結果を整形して、最終的にCSV形式で出力できる。  

---

## 2. 機能要件

### 2.1. 入力機能

1. **入力データの形式**  
   - 既存の「対戦組み合わせ決定ツール」が出力したCSVファイルを想定。  
   - 必須列（例）  
     - `級組`  
     - `座席 (A側)`  
     - `Id (A側)`  
     - `名前 (A側)`  
     - `所属 (A側)`  
     - `座席 (B側)`  
     - `Id (B側)`  
     - `名前 (B側)`  
     - `所属 (B側)`  
     - …（不戦勝の場合などはB側に`不戦勝`など）  
   - 任意列（例）  
     - 既に勝数などの情報があればその列を保持したまま読み込む。  

2. **文字コードおよび区切り文字への対応**  
   - `Shift_JIS`または`UTF-8`を判定して読み込む。  
   - 区切り文字はカンマ`,`をデフォルトとする（必要に応じてタブ`\t`にも対応）。

3. **不備データの取り扱い**  
   - 欠落した必須列がある場合はエラーを表示。  
   - 列の名称が予期しない場合、ユーザーに確認を促す。  

---

### 2.2. 対戦結果入力UI

1. **表示形式**  
   - CSVの各対戦カード1件につき、1行または1テーブル行を割り当てる。  
   - 「A側」「B側」など対戦者ペアが分かるように、2名分を横並びで表示する。  
   - 不戦勝の場合は勝者入力だけ可能にするなどのUI切り替えを行う。

2. **入力項目**  
   - 勝敗を示すラジオボタンやドロップダウン：`Aの勝利` / `Bの勝利`  
   - 必要に応じてスコア入力欄（例：取得枚数、残枚数など）。  
   - 追加でコメントやメモを入力するテキスト欄（必要に応じて）。  

3. **入力補助**  
   - UI上で入力完了・未完了がわかるように色やチェックアイコンで表示。  
   - タブキーや矢印キーで隣セルに移動しやすいレイアウトを想定。

4. **画面デザイン**  
   - 視認性の高いテーブルを採用。ヘッダーは強調表示し、背景色はストライプデザインなどで見やすくする。  
   - 座席番号、IDなどは中央揃え、名前や所属は左揃え。  

---

### 2.3. データ処理機能

1. **入力値の検証**  
   - 必須項目（勝敗ラジオボタンなど）が未選択の場合、エラーや警告を表示する。  
   - 数値が必要な欄（例：スコアや取得枚数）が誤った形式の場合、エラーを表示。  

2. **データの一時保存**  
   - ページ遷移やリロードに備えて、途中入力をブラウザローカルストレージに保存（検討事項）。  
   - またはフロントエンドのみで完結する運用であれば、ユーザーが明示的に「一時保存」ボタンを押せる設計も可。  

3. **勝者・敗者列の生成**  
   - ユーザーの選択内容をもとに、自動で勝者・敗者のIDや名前を判定して内部データを作成。  
   - CSV出力用の形（例： `試合番号, 勝者ID, 勝者氏名, 敗者ID, 敗者氏名, スコア …` ）をあらかじめ用意しておく。  

---

### 2.4. 出力機能

1. **CSV出力**  
   - 入力された結果を取り込み、次のような列を含むCSVを生成:  
     - `試合番号`  
     - `級・組`  
     - `勝者 Id` / `勝者 名前` / (任意で) `勝者 スコア`  
     - `敗者 Id` / `敗者 名前` / (任意で) `敗者 スコア`  
     - 必要に応じてメモ欄やコメント欄  
   - 既存の対戦組み合わせCSVから継承した情報（ID、名前など）を保持したまま、ユーザーの入力内容（勝敗、スコアなど）を追加して出力する。

2. **ファイルダウンロード**  
   - ブラウザ上から直接CSVファイルをダウンロードできるようにする。  
   - CSVの文字コードは`Shift_JIS`または`UTF-8`を選択可能にする（運用環境による）。  

3. **UI上の表示**  
   - 出力用のプレビュー表示機能を備える（任意要件）。  
   - 最終チェックのために、ダウンロード前にユーザーが結果を確認できる画面を用意する。

---

## 3. 非機能要件

1. **操作性**  
   - シンプルかつ直感的に操作できるUIを提供する。  
   - フォーム入力に慣れていないユーザーでも分かりやすいレイアウトを心がける。  

2. **性能**  
   - 参加者数が多くても（数百～数千程度）、ブラウザ上で表示やCSV書き出しがスムーズに行える。  

3. **互換性**  
   - 最新の主要ブラウザ（Chrome, Firefox, Edge）で動作可能とする。  

---

## 4. 要件まとめ図

### 4.1. フロー図

```text
【入力】
   ├── 1. 既存ツールが出力した対戦組み合わせCSVをアップロード
   └── 2. 対戦組み合わせCSVの読み込み・解析
         - 必須列の存在確認
         - 列のデータ整合性チェック
         ↓
【UI表示】
   └── 対戦一覧テーブル生成
       - A側, B側のプレイヤー情報を表示
       - 不戦勝があれば、その旨を表示
       ↓
【結果入力】
   ├── 勝敗の選択（ラジオボタンなど）
   ├── スコアやコメント入力（任意）
   └── 入力確認
       - 未入力やエラーがあれば警告表示
       ↓
【出力】
   ├── ユーザーが「結果をCSV出力」ボタン押下
   └── CSVファイル生成
       - 試合番号, 勝者, 敗者, スコア等を列に書き出す
       - ダウンロードリンク表示
```

### 4.2. フロー図

```text
src/
 ├── matchResultInput.html          // 対戦結果入力画面のメインHTML
 ├── style.css           // UIデザイン
 ├── resultInput.js      // イベントドリブンで入力フォーム操作/結果集計を行う
 ├── parseCSV.js         // CSV解析ロジック
 ├── exportCSV.js        // 最終的な結果をCSV形式で出力する
```

### 4.3. エラーハンドリング

- 入力エラー
  - CSV必須列がない場合や列名が一致しない場合、エラーメッセージを表示。
  - フォーム上で勝敗選択が抜けている場合、バリデーションエラーを表示。
- 処理エラー
  - CSVパース中のエラーや文字コード判定の失敗時にはエラーを通知。
  - ブラウザのセキュリティ設定により、ローカルファイル読み込み不可の場合もエラーメッセージを表示。

### 5. 実装範囲

- フロントエンド実装
  - HTML, JavaScript（ネイティブ）をメインとし、CSV入出力、フォーム入力、データのバリデーション。
  - 必要に応じて、利用頻度の高いCSVパースライブラリ（PapaParse等）の導入を検討。
